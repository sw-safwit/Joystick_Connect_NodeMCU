#include <PS2X_lib.h>  //for v1.6
#define PS2_DAT 12  // GPIO 12 (D6)
#define PS2_CMD 13  // GPIO 13 (D7)
#define PS2_SEL 0   // GPIO 0 (D3) - ใช้สำหรับขา CS/ATT
#define PS2_CLK 14  // GPIO 14 (D5)
const int pinPositive = 5; // D1 
const int pinNegative = 4; // D2 
//#define pressures    true
#define pressures false
//#define rumble         true
#define rumble false
PS2X ps2x;  // create PS2 Controller Class
int error = 0;
byte type = 0;
byte vibrate = 0;
void setup() {
  Serial.begin(115200);
  delay(300);  //ให้เวลา module startup
  pinMode(pinPositive, OUTPUT);
  pinMode(pinNegative, OUTPUT);
  error = ps2x.config_gamepad(PS2_CLK, PS2_CMD, PS2_SEL, PS2_DAT, pressures, rumble);
  if (error == 0) {
    Serial.print("Found Controller, configured successful ");
    Serial.print("pressures = ");
    if (pressures)
      Serial.println("true ");
    else
      Serial.println("false");
    Serial.print("rumble = ");
    if (rumble)
      Serial.println("true)");
    else
      Serial.println("false");
    Serial.println("Try out all the buttons, X will vibrate the controller, faster as you press harder;");
    Serial.println("holding L1 or R1 will print out the analog stick values.");
    Serial.println("------------------------------------");
  } else if (error == 1)
    Serial.println("ERROR 1: No controller found, check wiring and wireless link.");
  else if (error == 2)
    Serial.println("ERROR 2: Controller found but not accepting commands.");
  else if (error == 3)
    Serial.println("ERROR 3: Controller refusing to enter Pressures mode.");
  type = ps2x.readType();
  switch (type) {
    case 0:
      Serial.print("Unknown Controller type found ");
      break;
    case 1:
      Serial.print("DualShock Controller found ");
      break;
    case 2:
      Serial.print("GuitarHero Controller found ");
      break;
    case 3:
      Serial.print("Wireless Sony DualShock Controller found ");
      break;
  }
  Serial.println("");  // บรรทัดเปล่า
}
void loop() {
  if (error == 1)  //skip loop if no controller found
    return;
  if (type == 2) {  //Guitar Hero Controller (ข้ามส่วนนี้ถ้าใช้จอยปกติ)
    ps2x.read_gamepad();
  } else {  //DualShock Controller (ใช้ส่วนนี้)
    ps2x.read_gamepad(false, vibrate);
    if (ps2x.Button(PSB_START)){
      Serial.println("Start is being held");
    }
    if (ps2x.Button(PSB_SELECT))
      Serial.println("Select is being held");
    if (ps2x.Button(PSB_PAD_UP)) {
      Serial.println("Up");
      digitalWrite(pinPositive, HIGH); // ส่งสัญญาณบวก 
      digitalWrite(pinNegative, LOW);  // ส่งสัญญาณลบ 
    }
    if (ps2x.Button(PSB_PAD_DOWN)) {
      Serial.println("Down");
      digitalWrite(pinPositive, LOW); // ส่งสัญญาณบวก 
      digitalWrite(pinNegative, HIGH);  // ส่งสัญญาณลบ 
    }
    if (ps2x.Button(PSB_PAD_LEFT)) {
      Serial.println("LEFT");
      digitalWrite(pinPositive, HIGH); // ส่งสัญญาณบวก 
      digitalWrite(pinNegative, HIGH);  // ส่งสัญญาณลบ 
    }
    if (ps2x.Button(PSB_PAD_RIGHT)) {
      Serial.println("Right");
      digitalWrite(pinPositive, LOW); // ส่งสัญญาณบวก 
      digitalWrite(pinNegative, LOW);  // ส่งสัญญาณลบ 
    }
    // ... (โค้ดส่วนอื่น ๆ เหมือนเดิม) ...
    if (ps2x.Button(PSB_L1) || ps2x.Button(PSB_R1)) {  //print stick values if either is TRUE
      Serial.print("Stick Values (LY,LX,RY,RX): ");
      Serial.print(ps2x.Analog(PSS_LY), DEC);
      Serial.print(",");
      Serial.print(ps2x.Analog(PSS_LX), DEC);
      Serial.print(",");
      Serial.print(ps2x.Analog(PSS_RY), DEC);
      Serial.print(",");
      Serial.println(ps2x.Analog(PSS_RX), DEC);
    }
  }
  delay(50);
}